<!-- The injection is happening in the populate children robot scripts js override -->
<svelte:options customElement="rest-request-to-curl-module" />

<script lang="ts">
  import * as Dialog from "$lib/components/ui/dialog";
  import { generateCurlCommands } from "$lib/features/curl-generator/curl-generator.service";
  import { injectTailwindStyleForShadowDOM } from "$lib/styles/tailwind-style-injection";
  import { cn } from "$lib/utils";
  import { Terminal } from "lucide-svelte";
  import { buttonVariants } from "../ui/button";
  import { CodeBlock } from "$lib/components/shared/code-block";

  let { requestDataText }: { requestDataText: string } = $props();

  injectTailwindStyleForShadowDOM($host());

  let dialogContainer: HTMLElement | null = $state(null);

  const curlRequestSnippets = $derived(generateCurlCommands(requestDataText));

  // TODO must split this, make it more modular more clean
</script>

<div class="mb-4 flex flex-col items-start">
  <div bind:this={dialogContainer} class="h-0"></div>

  <Dialog.Root>
    <Dialog.Trigger
      class={cn(buttonVariants({ variant: "outline" }), "w-full")}
    >
      <Terminal class="mr-2 h-4 w-4" />
      Copy as cURL request
    </Dialog.Trigger>
    <Dialog.Content
      class="flex h-full max-h-[80vh] flex-col sm:max-w-4xl"
      portalProps={{ to: dialogContainer }}
    >
      <Dialog.Header>
        <Dialog.Title>Copy as cURL request</Dialog.Title>
        <Dialog.Description>
          Select your desired format and copy the command.
        </Dialog.Description>
      </Dialog.Header>

      <CodeBlock snippets={curlRequestSnippets} />
    </Dialog.Content>
  </Dialog.Root>
</div>
